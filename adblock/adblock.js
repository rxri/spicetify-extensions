"use strict";const loadWebpack=()=>{try{const n=window.webpackChunkclient_web.push([[Symbol()],{},o=>o]),i=Object.keys(n.m).map(o=>n(o)),l=i.filter(o=>typeof o=="object").flatMap(o=>{try{return Object.values(o)}catch{}}).filter(o=>typeof o=="function");return{cache:i,functionModules:l}}catch(n){return console.error("adblockify: Failed to load webpack",n),{cache:[],functionModules:[]}}},getSettingsClient=(n,i=[],l={})=>{try{const o=n.find(s=>s?.settingsClient)?.settingsClient;if(!o){const s=i.find(c=>c?.SERVICE_ID==="spotify.ads.esperanto.settings.proto.Settings"||c?.SERVICE_ID==="spotify.ads.esperanto.proto.Settings");return new s(l)}return o}catch(o){return console.error("adblockify: Failed to get ads settings client",o),null}},getSlotsClient=(n,i)=>{try{const l=n.find(o=>o.SERVICE_ID==="spotify.ads.esperanto.slots.proto.Slots"||o.SERVICE_ID==="spotify.ads.esperanto.proto.Slots");return new l(i)}catch(l){return console.error("adblockify: Failed to get slots client",l),null}},map=new Map,retryCounter=(n,i)=>{if(map.has(n)||map.set(n,{count:0}),i==="increment")map.get(n).count++;else if(i==="clear")map.delete(n);else if(i==="get")return map.get(n)?.count};(async function n(){await new Promise(e=>Spicetify.Events.platformLoaded.on(e)),await new Promise(e=>Spicetify.Events.webpackLoaded.on(e));const i=loadWebpack(),{Platform:l,Locale:o}=Spicetify,{AdManagers:s}=l;if(!s?.audio||Object.keys(s).length===0){setTimeout(n,100);return}const{audio:c}=s,{UserAPI:y}=l,u=y._product_state||y._product_state_service||l?.ProductStateAPI?.productStateApi,p=Spicetify.Platform.version.split(".").map(e=>Number.parseInt(e));if(!Spicetify?.CosmosAsync){setTimeout(n,100);return}const{CosmosAsync:m}=Spicetify,b=await m.get("sp://ads/v1/slots"),A=()=>{const e=document.createElement("style"),t=o.get("upgrade.tooltip.title");e.className="adblockify",e.innerHTML=`.nHCJskDZVlmDhNNS9Ixv, .utUDWsORU96S7boXm2Aq, .cpBP3znf6dhHLA2dywjy, .G7JYBeU1c2QawLyFs5VK, .vYl1kgf1_R18FCmHgdw2, .vZkc6VwrFz0EjVBuHGmx, .iVAZDcTm1XGjxwKlQisz, ._I_1HMbDnNlNAaViEnbp, .xXj7eFQ8SoDKYXy6L3E1, .F68SsPm8lZFktQ1lWsQz, .MnW5SczTcbdFHxLZ_Z8j, .WiPggcPDzbwGxoxwLWFf, .ReyA3uE3K7oEz7PTTnAn, .x8e0kqJPS0bM4dVK7ESH, .gZ2Nla3mdRREDCwybK6X, .SChMe0Tert7lmc5jqH01, .AwF4EfqLOIJ2xO7CjHoX, .UlkNeRDFoia4UDWtrOr4, .k_RKSQxa2u5_6KmcOoSw, ._mWmycP_WIvMNQdKoAFb, .O3UuqEx6ibrxyOJIdpdg, .akCwgJVf4B4ep6KYwrk5, .bIA4qeTh_LSwQJuVxDzl, .ajr9pah2nj_5cXrAofU_, .gvn0k6QI7Yl_A0u46hKn, .obTnuSx7ZKIIY1_fwJhe, .IiLMLyxs074DwmEH4x5b, .RJjM91y1EBycwhT_wH59, .mxn5B5ceO2ksvMlI1bYz, .l8wtkGVi89_AsA3nXDSR, .Th1XPPdXMnxNCDrYsnwb, .SJMBltbXfqUiByDAkUN_, .Nayn_JfAUsSO0EFapLuY, .YqlFpeC9yMVhGmd84Gdo, .HksuyUyj1n3aTnB4nHLd, .DT8FJnRKoRVWo77CPQbQ, ._Cq69xKZBtHaaeMZXIdk, .main-leaderboardComponent-container, .sponsor-container, a.link-subtle.main-navBar-navBarLink.GKnnhbExo0U9l7Jz2rdc, button[title="${t}"], button[aria-label="${t}"], .main-topBar-UpgradeButton, .main-contextMenu-menuItem a[href^="https://www.spotify.com/premium/"], div[data-testid*="hpto"] {display: none !important;}`,document.head.appendChild(e)},I=async()=>{try{await u.putOverridesValues({pairs:{ads:"0",catalogue:"premium",product:"premium",type:"premium"}})}catch(e){console.error("adblockify: Failed inside `disableAds` function\n",e)}},S=async()=>{try{const{billboard:e,leaderboard:t,sponsoredPlaylist:a}=s;if(await m.post("sp://ads/v1/testing/playtime",{value:-1e11}),await c.disable(),c.isNewAdsNpvEnabled=!1,await e.disable(),await t?.disableLeaderboard(),await a.disable(),s?.inStreamApi){const{inStreamApi:r}=s;await r.disable()}if(s?.vto){const{vto:r}=s;await r.manager.disable(),r.isNewAdsNpvEnabled=!1}setTimeout(I,100)}catch(e){console.error("adblockify: Failed inside `configureAdManagers` function\n",e)}},k=async()=>{for(const e of b)M(e.slot_id),setTimeout(()=>f({adSlotEvent:{slotId:e.slot_id}}),50)},f=e=>{const t=e?.adSlotEvent?.slotId;try{const a=c?.inStreamApi?.adsCoreConnector;typeof a?.clearSlot=="function"&&a.clearSlot(t);const r=getSlotsClient(i.functionModules,u.transport);r&&r.clearAllAds({slotId:t}),g(t)}catch(a){if(console.error("adblockify: Failed inside `handleAdSlot` function. Retrying in 1 second...\n",a),retryCounter(t,"increment"),retryCounter(t,"get")>5){console.error(`adblockify: Failed inside \`handleAdSlot\` function for 5th time. Giving up...
Slot id: ${t}.`),retryCounter(t,"clear");return}setTimeout(f,1*1e3,e)}S()},g=async e=>{try{const t=getSettingsClient(i.cache,i.functionModules,u.transport);if(!t)return;const a=p[0]===1&&p[1]>=2&&p[2]>=82?0n:"0";await t.updateAdServerEndpoint({slotIds:[e],url:"http://localhost/no/thanks"}),await t.updateStreamTimeInterval({slotId:e,timeInterval:a}),await t.updateSlotEnabled({slotId:e,enabled:!1}),await t.updateDisplayTimeInterval({slotId:e,timeInterval:a})}catch(t){console.error("adblockify: Failed inside `updateSlotSettings` function\n",t)}},C=async()=>{for(const e of b)g(e.slot_id)},M=e=>{try{c.inStreamApi.adsCoreConnector.subscribeToSlot(e,f)}catch(t){console.error("adblockify: Failed inside `subToSlot` function\n",t)}},E=()=>{const e=Array.from(document.querySelectorAll(".ReactModalPortal")),t=new MutationObserver(a=>{for(const r of a)if(r.addedNodes.length){const d=r.addedNodes[0];if(!d.classList.contains("GenericModal__overlay"))continue;const v=d.querySelector("iframe");if(!v)continue;const h=v?.contentWindow?.document.body;if(!h||!h.querySelector("[data-click-to-action-url*='/premium-promotional-offer-terms']"))continue;d.remove()}});for(const a of e)t.observe(a,{childList:!0})},w=async()=>{try{const e=JSON.parse(localStorage.getItem("spicetify-exp-features")||"{}");typeof e?.enableEsperantoMigration?.value<"u"&&(e.enableEsperantoMigration.value=!0),typeof e?.enableInAppMessaging?.value<"u"&&(e.enableInAppMessaging.value=!1),typeof e?.hideUpgradeCTA?.value<"u"&&(e.hideUpgradeCTA.value=!0),typeof e?.enablePremiumUserForMiniPlayer?.value<"u"&&(e.enablePremiumUserForMiniPlayer.value=!0),localStorage.setItem("spicetify-exp-features",JSON.stringify(e));const t={enableEsperantoMigration:!0,enableInAppMessaging:!1,hideUpgradeCTA:!0,enablePremiumUserForMiniPlayer:!0};if(Spicetify?.RemoteConfigResolver){const a=Spicetify.createInternalMap(t);Spicetify.RemoteConfigResolver.value.setOverrides(a)}else if(Spicetify.Platform?.RemoteConfigDebugAPI){const a=Spicetify.Platform.RemoteConfigDebugAPI;for(const[r,d]of Object.entries(t))await a.setOverride({source:"web",type:"boolean",name:r},d)}}catch(e){console.error("adblockify: Failed inside `enableExperimentalFeatures` function\n",e)}};k(),A(),u.subValues({keys:["ads","catalogue","product","type"]},()=>S()),w(),setTimeout(w,3*1e3),setTimeout(C,5*1e3)})();
